!new function(window,document,undefined,$){"use strict";var MODULE;!function(a){var c;!function(a){a.NAME="pjax",a.NAMESPACE=jQuery}(c=a.DEF||(a.DEF={}))}(MODULE||(MODULE={}));var MODULE;!function(a){!function(a){a[a.blank=0]="blank",a[a.initiate=1]="initiate",a[a.open=2]="open",a[a.pause=3]="pause",a[a.lock=4]="lock",a[a.seal=5]="seal",a[a.error=6]="error",a[a.crash=7]="crash",a[a.terminate=8]="terminate",a[a.close=9]="close"}(a.State||(a.State={})),a.State,a.EVENT={PJAX:a.DEF.NAME.toLowerCase(),CLICK:"click",SUBMIT:"submit",POPSTATE:"popstate",SCROLL:"scroll"}}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(){}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(){}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(){}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){function c(a,c){var h=a.prototype;c=c.reverse();for(var d=c.length;d--;){var e=c[d].prototype;for(var f in e)"constructor"!==f&&h[f]&&e.hasOwnProperty(f)&&(h[f]=e[f])}}function h(){function a(a){var c=16*Math.random()|0,h="x"==a?c:3&c|8;return h.toString(16).toUpperCase()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a)}function d(a,c){if(!Object.freeze||a===a.window||"ownerDocument"in a)return a;if(!Object.isFrozen(a)&&Object.freeze(a),!c)return a;for(var h in a){var e=a[h];~"object,function".indexOf(typeof e)&&e&&d(e,c)}return a}function e(a,c){if(!Object.seal||a===a.window||"ownerDocument"in a)return a;if(!Object.isSealed(a)&&Object.seal(a),!c)return a;for(var h in a){var d=a[h];~"object,function".indexOf(typeof d)&&d&&e(d,c)}return a}a.MIXIN=c,a.UUID=h,a.FREEZE=d,a.SEAL=e}(MODULE||(MODULE={}));var MODULE;!function(){}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(){function c(c){this.NAME=a.DEF.NAME,this.NAMESPACE=a.DEF.NAMESPACE,this.UUID=a.UUID(),this.state_=a.State.blank,this.state_=c}return c.prototype.MAIN=function(a){for(var c=[],h=1;h<arguments.length;h++)c[h-1]=arguments[h];return this.main_.apply(this,[a].concat(c))},c.prototype.main_=function(a){for(var c=[],h=1;h<arguments.length;h++)c[h-1]=arguments[h];return a},c}();c.Template=h}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(){function c(c){this.UUID=a.UUID(),this.state_=a.State.blank,this.state_=c}return c}();c.Template=h}(c=a.VIEW||(a.VIEW={}))}(MODULE||(MODULE={}));var __extends=this&&this.__extends||function(a,c){function h(){this.constructor=a}for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);a.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)},MODULE;!function(a){var c;!function(c){var h=function(c){function h(h,d,e,f){var _=this;c.call(this,a.State.initiate),this.model_=h,this.controller_=d,this.context_=e,this.handlers={click:function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];_.controller_.click(a)},submit:function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];_.controller_.submit(a)},popstate:function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];_.controller_.popstate(a)},scroll:function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];_.controller_.scroll(a)}},a.FREEZE(this),this.observe_(f)}return __extends(h,c),h.prototype.observe_=function(a){return this.release_(a),a.link&&this.context_.delegate(a.link,a.nss.event.click,this.handlers.click),a.form&&this.context_.delegate(a.form,a.nss.event.submit,this.handlers.submit),jQuery(window).bind(a.nss.event.popstate,this.handlers.popstate),a.database.active&&a.fix.scroll&&jQuery(window).bind(a.nss.event.scroll,this.handlers.scroll),this},h.prototype.release_=function(a){return a.link&&this.context_.undelegate(a.link,a.nss.event.click),a.form&&this.context_.undelegate(a.form,a.nss.event.submit),jQuery(window).unbind(a.nss.event.popstate),a.database.active&&a.fix.scroll&&jQuery(window).unbind(a.nss.event.scroll),this},h}(c.Template);c.Main=h}(c=a.VIEW||(a.VIEW={}))}(MODULE||(MODULE={}));var MODULE;!function(a){a.View=a.VIEW.Main}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(){function c(){a.FREEZE(this)}return c.prototype.enable=function(){return a.Model.singleton().enable(),this},c.prototype.disable=function(){return a.Model.singleton().disable(),this},c.prototype.click=function(c,h){var d;switch(typeof c){case"undefined":d=jQuery(this).filter("a").first().clone();break;case"object":d=jQuery(c).clone();break;case"string":h=jQuery.extend(!0,{},h,{href:c}),d=jQuery("<a/>",h);break;default:return this}var e=a.Model.singleton().configure(d[0]);return e&&d.first().one(e.nss.event.click,function(){for(var c=[],h=0;h<arguments.length;h++)c[h-0]=arguments[h];return a.Controller.singleton().click(c)}).click(),this},c.prototype.submit=function(c,h,d){var e,f,_,y=document.createDocumentFragment();switch(typeof c){case"undefined":e=jQuery(this).filter("form").first().clone();break;case"object":e=jQuery(c).clone();break;case"string":h=jQuery.extend(!0,{},h,{action:c}),f=d instanceof Array&&Array||d instanceof Object&&Object||undefined;for(var i in d){switch(f){case Object:if(!Object.prototype.hasOwnProperty.call(d,i))continue;_=jQuery("<textarea/>",{name:i}).val(d[i]);break;case Array:d[i].attrs=d[i].attrs||{},d[i].attrs.name=d[i].name||d[i].attrs.name,d[i].attrs.type=d[i].type||d[i].attrs.type,_=jQuery("<"+d[i].tag+"/>",d[i].attrs).val(d[i].value);break;default:continue}y.appendChild(_[0])}e=jQuery("<form/>",h).append(y);break;default:return this}var v=a.Model.singleton().configure(e[0]);return v&&e.first().one(v.nss.event.submit,function(){for(var c=[],h=0;h<arguments.length;h++)c[h-0]=arguments[h];return a.Controller.singleton().submit(c)}).submit(),this},c.prototype.getCache=function(c){void 0===c&&(c=window.location.href);var h=a.Model.singleton().getCache(c);return h&&(h={data:h.data,textStatus:h.textStatus,jqXHR:h.jqXHR,expires:h.expires}),h},c.prototype.setCache=function(c,h,d,e){switch(void 0===c&&(c=window.location.href),arguments.length){case 0:return this.setCache(c,document.documentElement.outerHTML);case 1:return this.setCache(c,null);case 2:case 3:case 4:default:a.Model.singleton().setCache(c,h,d,e)}return this},c.prototype.removeCache=function(c){return void 0===c&&(c=window.location.href),a.Model.singleton().removeCache(c),this},c.prototype.clearCache=function(){return a.Model.singleton().clearCache(),this},c.prototype.follow=function(c,h,d,e){if(!a.Model.singleton().isDeferrable)return!1;var f=c.currentTarget;return h.follow=!0,h.host=d||"",isFinite(c.timeStamp)&&(h.timeStamp=e||c.timeStamp),a.Model.singleton().setPageXHR(h),jQuery.when(h).done(function(){!a.Model.singleton().getCache(f.href)&&a.Model.singleton().isOperatable(c)&&a.Model.singleton().setCache(f.href,undefined,undefined,h)}),jQuery[a.DEF.NAME].click(f.href),!0},c.prototype.bypass=function(){return a.Model.singleton().bypass()},c.prototype.host=function(){return a.Model.singleton().host()},c}();c.Functions=h}(c=a.CONTROLLER||(a.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(){function c(){a.FREEZE(this)}return c}();c.Methods=h}(c=a.CONTROLLER||(a.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(){function c(c,h){this.UUID=a.UUID(),this.state_=a.State.blank,this.PROPERTIES=[],this.state_=h}return c.prototype.EXTEND=function(c){return c instanceof a.DEF.NAMESPACE?(c instanceof jQuery&&(c=c.add()),this.REGISTER_FUNCTION(c),this.REGISTER_METHOD(c)):(c!==this.EXTENSION&&(c=this.EXTENSION),this.REGISTER_FUNCTION(c)),this.UPDATE_PROPERTIES(c),c},c.prototype.REGISTER=function(c){var h=this;this.EXTENSION=this.EXTENSION||function(){for(var a=[],d=0;d<arguments.length;d++)a[d-0]=arguments[d];var e=h.EXTEND(this);return a=[e].concat(a),a=h.EXEC.apply(h,a),a instanceof Array?c.MAIN.apply(c,a):a},this.EXTEND(this.EXTENSION),window[a.DEF.NAMESPACE]=window[a.DEF.NAMESPACE]||{},a.DEF.NAMESPACE[a.DEF.NAME]=a.DEF.NAMESPACE.prototype?a.DEF.NAMESPACE.prototype[a.DEF.NAME]=this.EXTENSION:this.EXTENSION},c.prototype.EXEC=function(){return this.exec_.apply(this,arguments)},c.prototype.exec_=function(a){for(var c=[],h=1;h<arguments.length;h++)c[h-1]=arguments[h];return[a].concat(c)},c.prototype.REGISTER_FUNCTION=function(a){var c=this.FUNCTIONS;for(var h in c)"constructor"!==h&&(a[h]=c[h]);return a},c.prototype.REGISTER_METHOD=function(a){var c=this.METHODS;for(var h in c)"constructor"!==h&&(a[h]=c[h]);return a},c.prototype.UPDATE_PROPERTIES=function(a){var c,h,d,e=this.PROPERTIES;for(c=0,h=e.length;h>c;c++)"constructor"!==c&&(d=e[c],a[d]&&(a[d]=a[d]()));return a},c}();c.Template=h}(c=a.CONTROLLER||(a.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(h){function d(d){h.call(this,d,a.State.initiate),this.model_=d,this.FUNCTIONS=new c.Functions,this.METHODS=new c.Methods,this.REGISTER(d),a.FREEZE(this)}return __extends(d,h),d.prototype.exec_=function(a){var c=[].slice.call(arguments,1,2),h=c[0];switch(typeof h){case"undefined":case"object":break;default:return a}return[a].concat(c)},d.prototype.view=function(c,h){return new a.View(this.model_,this,c,h)},d.prototype.click=function(a){this.model_.click.apply(this.model_,a)},d.prototype.submit=function(a){this.model_.submit.apply(this.model_,a)},d.prototype.popstate=function(a){this.model_.popstate.apply(this.model_,a)},d.prototype.scroll=function(a){this.model_.scroll.apply(this.model_,a)},d}(c.Template);c.Main=h;var d=function(){function c(d){void 0===d&&(d=a.Model.singleton()),c.instance_=c.instance_||new h(d)}return c.singleton=function(){return c.instance_},c.prototype.singleton=function(){return c.singleton()},c}();c.Singleton=d}(c=a.CONTROLLER||(a.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(a){a.Controller=a.CONTROLLER.Singleton}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c=function(){function a(a,c){void 0===a&&(a=1),void 0===c&&(c=0),this.list_=[],this.config_={mode:1,size:0},this.table_={},this.option_={},this.config_.mode=a||this.config_.mode,this.config_.size=c||this.config_.size}return a.prototype.define=function(a,c,h){void 0===c&&(c=this.config_.mode),void 0===h&&(h=this.config_.size),this.option_[a]={mode:c,size:h},this.table_[a]=[]},a.prototype.reserve=function(a,c){switch(typeof a){case"string":!this.option_[a]&&this.define(a);var h=this.option_[a],d=this.table_[a],e=[].slice.call(arguments,2);break;case"function":c=a,a=undefined;var h=this.config_,d=this.list_,e=[].slice.call(arguments,1);break;default:return}if("function"==typeof c){var f;f=h.mode>0?"push":"unshift",d[f]([c,e.shift(),e])}},a.prototype.digest=function(a,c){switch(typeof a){case"string":!this.option_[a]&&this.define(a),c=c||0;var h=this.option_[a],d=this.table_[a];if(!d)return;break;case"number":case"undefined":c=a||0,a=undefined;var h=this.config_,d=this.list_;break;default:return}d.length>h.size&&h.size&&(h.mode>0?d.splice(0,d.length-h.size):d.splice(d.length-h.size,d.length));var e;for(c=c||-1;e=c--&&d.pop();)e.shift().apply(e.shift()||window,e.shift()||[]);if(undefined===a){var f=this.table_;for(var _ in f)this.digest(_,c)}},a.prototype.clear=function(a){switch(typeof a){case"string":!this.option_[a]&&this.define(a),this.table_[a].splice(0,this.table_[a].length);break;default:var c=this.table_;for(var h in c)this.clear(h)}},a}();a.Task=c}(c=a.LIBRARY||(a.LIBRARY={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c=function(){function a(a){this.task_=a,this.labels_={done:"done",fail:"fail",always:"always"}}return a.prototype.done=function(a){return this.task_.reserve(this.labels_.done,a),this},a.prototype.fail=function(a){return this.task_.reserve(this.labels_.fail,a),this},a.prototype.always=function(a){return this.task_.reserve(this.labels_.always,a),this},a.prototype.resolve=function(){return this.task_.clear(this.labels_.fail),this.task_.digest(this.labels_.done),this.task_.digest(this.labels_.always),this},a.prototype.reject=function(){return this.task_.clear(this.labels_.done),this.task_.digest(this.labels_.fail),this.task_.digest(this.labels_.always),this},a}();a.Task=c;var h=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c}(c);a.TaskUp=h;var d=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c.prototype.done=function(){return this},c.prototype.fail=function(){return this},c.prototype.always=function(){return this},c.prototype.resolve=function(){return this},c}(c);a.TaskDown=d}(c=a.STATEFUL||(a.STATEFUL={}))}(c=a.DB||(a.DB={}))}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h;!function(c){var h;!function(c){var h=function(){function h(c,h,d){var e=this;this.origin_=c,this.connect_=h,this.extend_=d,this.state_=function(){return e.origin_.state()},this.task_=new a.LIBRARY.Task,this.cache_={stateful:{}}}return h.prototype.stateful_=function(){var h=this,d=function(a,c){return h.cache_.stateful[h.state_()]=h.cache_.stateful[h.state_()]||new a(h.origin_,h.connect_,h.extend_,h.task_,c)};switch(this.state_()){case a.State.blank:return d(c.STATE.Blank,!0);case a.State.initiate:return d(c.STATE.Initiate,!0);case a.State.open:return d(c.STATE.Open,!0);case a.State.close:return d(c.STATE.Close,!0);case a.State.terminate:return d(c.STATE.Terminate,!0);case a.State.error:return d(c.STATE.Error,!1);default:return d(c.STATE.Except,!1)}},h.prototype.open=function(){return this.stateful_().open()},h.prototype.resolve=function(){return this.stateful_().resolve()},h.prototype.reject=function(){return this.stateful_().reject()},h}();c.Stateful=h}(h=c.DB||(c.DB={}))}(h=c.DATA||(c.DATA={}))}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(c){var h=function(){function c(c,h,d,e,f){this.origin=c,this.connect=h,this.extend=d,this.task=f?new a.STATEFUL.TaskUp(e):new a.STATEFUL.TaskDown(e)}return c.prototype.open=function(){return this.task},c.prototype.resolve=function(){},c.prototype.reject=function(){this.task.reject()},c}();c.Default=h;var d=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c.prototype.open=function(){return this.connect(),this.task},c.prototype.resolve=function(){this.open()},c.prototype.reject=function(){this.task.reject()},c}(h);c.Blank=d;var e=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c.prototype.open=function(){return this.task},c.prototype.resolve=function(){},c.prototype.reject=function(){this.task.reject()},c}(h);c.Initiate=e;var f=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c.prototype.open=function(){var a=this;return this.extend(),setTimeout(function(){return a.origin.resolve()},1),this.task},c.prototype.resolve=function(){this.task.resolve()},c.prototype.reject=function(){this.task.reject()},c}(h);c.Open=f;var _=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c.prototype.open=function(){return this.connect(),this.task},c.prototype.resolve=function(){this.open()},c.prototype.reject=function(){this.task.reject()},c}(h);c.Close=_;var y=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c}(h);c.Terminate=y;var i=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c}(h);c.Error=i;var v=function(a){function c(){a.apply(this,arguments)}return __extends(c,a),c}(h);c.Except=v}(c=a.STATE||(a.STATE={}))}(c=a.DB||(a.DB={}))}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c=function(){function a(a){this.DB=a,this.autoIncrement=!1,this.indexes=[],this.size=100,this.buffer={},this.diff={}}return a.prototype.accessStore=function(a,c){var h=this;void 0===c&&(c="readwrite");try{var d=this.DB.database(),e=d&&d.transaction(this.name,c).objectStore(this.name)}catch(f){}e?a(e):this.DB.open().done(function(){return h.accessStore(a)})},a.prototype.accessCount=function(){var a="string"==typeof arguments[0]&&arguments[0],c=arguments[a?1:0];this.accessStore(function(h){var d=a?h.index(a).count():h.count();d.onsuccess=function(){c.apply(this,[].slice.call(arguments,1).concat(this.result))}})},a.prototype.accessRecord=function(a,c,h){this.accessStore(function(h){h.get(a).onsuccess=c},h)},a.prototype.accessCursor=function(a,c,h,d){this.accessStore(function(e){var f;f=h&&c?e.index(a).openCursor(c,h):c?e.index(a).openCursor(c):e.openCursor(),f.onsuccess=d})},a.prototype.accessAll=function(a,c,h,d){"function"==typeof a&&(d=a,a=null,c=null,h=null),this.accessCursor(a,c,h,d)},a.prototype.get=function(a,c){var h=this;this.accessRecord(a,function(a){h.setBuffer(a.target.result),c(a)})},a.prototype.set=function(a,c){var h=this;a=jQuery.extend(!0,{},a),this.setBuffer(a,c),this.accessRecord(a[this.keyPath],function(d){d.target.source.put(c?jQuery.extend(!0,{},d.target.result,a):a),h.autoIncrement||delete h.diff[a[h.keyPath]]})},a.prototype.remove=function(a){this.removeBuffer(a),this.accessStore(function(c){c["delete"](a)})},a.prototype.clear=function(){this.clearBuffer(),this.accessStore(function(a){a.clear()})},a.prototype.clean=function(){var a=this;if(this.size&&this.indexes.length){var c=this.indexes[0].name,h=this.size;this.accessCount(c,function(d){h>=d||(h=d-h,a.accessCursor(c,a.DB.IDBKeyRange.upperBound(1/0),"next",function(c){if(c.target.result&&h--){var d=c.target.result;delete a.diff[d.primaryKey],d["delete"](),d["continue"]()}}))})}},a.prototype.loadBuffer=function(a){function c(){if(!this.result)return a&&a();var c=this.result;h[c.primaryKey]=c.value,c["continue"]()}if(!this.autoIncrement){var h=this.buffer;this.indexes.length?this.DB.IDBKeyRange&&this.accessAll(this.indexes[0].name,this.DB.IDBKeyRange.upperBound(1/0),"prev",c):this.accessAll(c)}},a.prototype.saveBuffer=function(a){var c=this;this.autoIncrement||this.accessStore(function(h){for(var d in c.diff)h.put(c.diff[d]);a&&a()})},a.prototype.getBuffers=function(){return this.buffer},a.prototype.setBuffers=function(a,c){for(var h in a)this.setBuffer(a[h],c);return this.buffer},a.prototype.getBuffer=function(a){return this.autoIncrement?void 0:this.buffer[a]},a.prototype.setBuffer=function(a,c){if(!this.autoIncrement){if(!a)return a;var h=a[this.keyPath];return this.buffer[h]=c?jQuery.extend(!0,{},this.buffer[h],a):a,this.diff[h]=this.buffer[h],this.buffer[h]}},a.prototype.removeBuffer=function(a){if(!this.autoIncrement){var c=this.buffer[a];return delete this.buffer[a],delete this.diff[a],c}},a.prototype.clearBuffer=function(){if(!this.autoIncrement){for(var a in this.buffer)delete this.buffer[a];for(var a in this.diff)delete this.diff[a]}},a}();a.Store=c}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(c){var h=function(a){function c(){a.apply(this,arguments),this.name="meta",this.keyPath="key",this.autoIncrement=!1,this.size=0}return __extends(c,a),c}(a.Store);c.Meta=h}(c=a.STORE||(a.STORE={}))}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(c){var h=function(a){function c(){a.apply(this,arguments),this.name="history",this.keyPath="url",this.autoIncrement=!1,this.indexes=[{name:"date",keyPath:"date",option:{unique:!1}}],this.size=300}return __extends(c,a),c}(a.Store);c.History=h}(c=a.STORE||(a.STORE={}))}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c;!function(c){var h=function(a){function c(){a.apply(this,arguments),this.name="server",this.keyPath="host",this.autoIncrement=!1,this.indexes=[{name:"score",keyPath:"score",option:{unique:!1}}],this.size=100}return __extends(c,a),c}(a.Store);c.Server=h}(c=a.STORE||(a.STORE={}))}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h;!function(c){var h=function(){function h(){var h=this;this.IDBFactory=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.msIDBKeyRange,this.name=a.DEF.NAME,this.version=10,this.refresh=10,this.upgrade=0,this.revision=0,this.state_=a.State.blank,this.stateful=new c.DB.Stateful(this,function(){return h.connect()},function(){return h.extend()}),this.age=1e4,this.expires=0,this.timer=0,this.stores={meta:new c.STORE.Meta(this),history:new c.STORE.History(this),server:new c.STORE.Server(this)},this.meta={version:{key:"version",value:undefined},update:{key:"update",value:undefined},revision:{key:"revision",value:undefined}}}return h.prototype.state=function(){return this.state_},h.prototype.extend=function(){var a=this;this.expires=(new Date).getTime()+this.age,clearTimeout(this.timer),this.timer=setTimeout(function(){return a.check()},this.age)},h.prototype.check=function(){!this.age||(new Date).getTime()<=this.expires||a.State.open===this.state()&&this.close()},h.prototype.database=function(){return this.extend(),this.database_},h.prototype.configure=function(a,c){this.revision=a,this.refresh=c},h.prototype.up=function(){this.state_=a.State.blank,this.open()},h.prototype.down=function(){this.reject(),this.close(),this.state_=a.State.error},h.prototype.open=function(){return!this.IDBFactory&&this.down(),this.stateful.open()},h.prototype.close=function(){this.database_&&this.database_.close&&this.database_.close(),this.state_=a.State.close},h.prototype.resolve=function(){this.stateful.resolve()},h.prototype.reject=function(){this.stateful.reject()},h.prototype.connect=function(){this.create()},h.prototype.create=function(){var c=this;try{this.close(),this.state_=a.State.initiate;var h=this.IDBFactory.open(this.name,this.upgrade?this.version:1),d=function(){c.verify(function(){c.state_=a.State.open,c.resolve(),c.extend()})};if("done"===h.readyState)this.database_=h.result,this.database()?d():this.format();else{var e=setTimeout(function(){return c.down()},3e3);h.onblocked=function(){clearTimeout(e),c.database_=h.result,c.close(),setTimeout(function(){return c.open()},1e3)},h.onupgradeneeded=function(){clearTimeout(e),c.database_=h.result,c.createStores()},h.onsuccess=function(){clearTimeout(e),c.database_=h.result,d()},h.onerror=function(){clearTimeout(e),c.database_=h.result,c.down()}}}catch(f){this.down()}},h.prototype.destroy=function(c,h){var d=this;try{this.close(),this.state_=a.State.terminate;var e=this.IDBFactory.deleteDatabase(this.name);e&&(e.onsuccess=c,e.onerror=h),setTimeout(function(){return a.State.terminate===d.state()&&d.down()},3e3)}catch(f){this.down()}},h.prototype.format=function(){var a=this;this.destroy(function(){return a.up()},function(){return a.down()})},h.prototype.verify=function(a){var c=this,h=this.database(),d=this.version,e=this.revision,f=this.meta,_=this.stores.meta,y=function(){return c.format()};if(h.objectStoreNames.length!==Object.keys(this.stores).length)return void y();for(var i in this.stores){var v=h.transaction(this.stores[i].name,"readonly").objectStore(this.stores[i].name);switch(!1){case v.keyPath===this.stores[i].keyPath:case v.indexNames.length===this.stores[i].indexes.length:return void y()}}var g=!1;_.get(f.version.key,function(a){if(!g){var h=a.target.result;!h||c.upgrade?_.set(_.setBuffer({key:f.version.key,value:d})):h.value>d?(g=!0,c.down()):h.value<d&&(g=!0,y())}}),_.get(f.revision.key,function(a){if(!g){var h=a.target.result;h?h.value>e?(g=!0,c.down()):h.value<e&&(g=!0,y()):_.set(_.setBuffer({key:f.revision.key,value:e}))}}),_.get(f.update.key,function(h){if(!g){var d=h.target.result,e=Math.floor((new Date).getTime()/864e5);d&&c.refresh?d.value>e?a():d.value<=e&&y():(_.set(_.setBuffer({key:f.update.key,value:e+c.refresh})),a())}})},h.prototype.createStores=function(){this.destroyStores();var a=this.database();for(var c in this.stores)for(var h,d=this.stores[c],e=a.createObjectStore(d.name,{keyPath:d.keyPath,autoIncrement:d.autoIncrement}),f=0,_=d.indexes;h=_[f];f++)e.createIndex(h.name,h.keyPath,h.option)},h.prototype.destroyStores=function(){for(var a=this.database(),c=a.objectStoreNames?a.objectStoreNames.length:0;c--;)a.deleteObjectStore(a.objectStoreNames[c])},h}();c.Database=h}(h=c.DATA||(c.DATA={}))}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c=function(){function a(a){this.age_=a}return a.prototype.getCookie=function(a){if(a&&window.navigator.cookieEnabled){var c=new RegExp("(?:^|; )("+encodeURIComponent(a)+"=[^;]*)"),h=(document.cookie.match(c)||[]).pop();return h&&decodeURIComponent(h.split("=").pop())}},a.prototype.setCookie=function(a,c,h){return void 0===h&&(h={}),a&&window.navigator.cookieEnabled?(h.age=h.age||this.age_,document.cookie=[encodeURIComponent(a)+"="+encodeURIComponent(c),h.age?"; expires="+new Date((new Date).getTime()+1e3*h.age).toUTCString():"",h.path?"; path="+h.path:"; path=/",h.secure?"; secure":""].join(""),this.getCookie(a)):void 0},a}();a.Cookie=c}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c;!function(a){var c=function(){function c(){this.DB=new a.Database,this.Cookie=new a.Cookie(864e3)}return c}();a.Main=c}(c=a.DATA||(a.DATA={}))}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c=function(){function a(){}return a.trim=function(a){if(a="string"==typeof a?a:String(0===a&&a.toString()||""),a.trim)a=a.trim();else if(a=a.replace(/^[\s\uFEFF\xA0]+/,"")){var c=/[\s\uFEFF\xA0]/,h=a.length,d=h%8;e:{for(;d--;)if(!c.test(a.charAt(--h)))break e;for(;h;){if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e;if(!c.test(a.charAt(--h)))break e}}a=a.substring(0,h+1)}return a},a.repeat=function(a,c){switch(a instanceof Array&&"array"||typeof a){case"string":var h=a;return Array(c+1).join(h);case"array":var d=a.length;if(300>c){var e=Array(c);this.duff(-c,function(c){return e[c]=a[c%d]})}else{for(var e=a.slice();2*e.length<=c;)e=e.concat(e);e=e.concat(e.slice(0,c-e.length))}return e}},a.fire=function(a,c,h,d){return void 0===c&&(c=window),void 0===h&&(h=[]),"function"==typeof a?d?setTimeout(function(){a.apply(c||window,h)},0):a.apply(c||window,h):a},a.duff=function(a,c){if(0>a){for(var h=-a,d=h%8;d--;)c(--h);for(;h;)c(--h),c(--h),c(--h),c(--h),c(--h),c(--h),c(--h),c(--h)}else{for(var e=a,h=0,d=e%8,f=e/8^0;d--;)c(h++);for(;f--;)c(h++),c(h++),c(h++),c(h++),c(h++),c(h++),c(h++),c(h++)}},a.duffEx=function(a,c){if(0>a){var h=-a,d=h%8;e:{for(;d--;)if(!1===c(--h))break e;for(;h;){if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e;if(!1===c(--h))break e}}}else{var e=a,h=0,d=e%8,f=e/8^0;e:{for(;d--;)if(!1===c(h++))break e;for(;f--;){if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e;if(!1===c(h++))break e}}}},a.normalizeUrl=function(a,c){void 0===c&&(c=!0);var h;return h=this.trim(a),h=/^([^:\/?#]+):\/\/[^\/?#.]+\.[^\/?#]+/i.test(h)?h:function(a,c){return c.href=a,c.href}(h,document.createElement("a")),h=encodeURI(decodeURI(h)),h=h.replace(/["`^|\\<>{}\[\]\s].*/,""),h=c?this.justifyPercentEncodingUrlCase_(a,h):h},a.canonicalizeUrl=function(a){function c(a){return a.toUpperCase()}var h=this.normalizeUrl(a,!1);return h=h.replace(/(?:%\w{2})+/g,c)},a.compareUrl=function(a,c){return a=this.canonicalizeUrl(a),c=this.canonicalizeUrl(c),a===c},a.justifyPercentEncodingUrlCase_=function(a,c){function h(c){var h=~a.indexOf(c.toUpperCase())||~a.indexOf(c.toLowerCase());return h?a.substr(~h,c.length):c}return a===c?c:c.replace(/(?:%\w{2})+/g,h)},a}();a.Utility=c}(c=a.LIBRARY||(a.LIBRARY={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h=function(){function h(h){this.model_=h,this.data_=new c.DATA.Main,this.stores_=this.data_.DB.stores,this.util_=a.LIBRARY.Utility}return h.prototype.getCookie=function(a){return this.data_.Cookie.getCookie(a)},h.prototype.setCookie=function(a,c,h){return this.data_.Cookie.setCookie(a,c,h)},h.prototype.connect=function(a){a.database.active?(this.data_.DB.configure(a.database.revision,a.database.refresh),this.data_.DB.up(),this.saveTitle(),this.saveScrollPosition()):this.data_.DB.down()},h.prototype.loadBuffers=function(){for(var a in this.stores_)this.stores_[a].loadBuffer()},h.prototype.saveBuffers=function(){for(var a in this.stores_)this.stores_[a].saveBuffer()},h.prototype.getHistoryBuffer=function(a){return this.stores_.history.getBuffer(this.model_.convertUrlToKey(a,!0))},h.prototype.loadTitle=function(){var a=this,c=this.model_.convertUrlToKey(window.location.href,!0),h=this.stores_.history.getBuffer(c);h&&"string"==typeof h.title?document.title=h.title:this.stores_.history.get(c,function(d){h=d.target.result,h&&h.title&&a.model_.compareKeyByUrl(c,a.util_.canonicalizeUrl(window.location.href))&&(document.title=h.title)})},h.prototype.saveTitle=function(a,c){void 0===a&&(a=window.location.href),void 0===c&&(c=document.title);var h=this.model_.convertUrlToKey(a,!0),d={url:h,title:c,date:(new Date).getTime(),scrollX:undefined,scrollY:undefined,host:undefined,expires:undefined};this.stores_.history.set(d,!0),this.stores_.history.clean()},h.prototype.loadScrollPosition=function(){function a(a,c){"number"==typeof a&&"number"==typeof c&&window.scrollTo(parseInt(Number(a)+"",10),parseInt(Number(c)+"",10))}var c=this,h=this.model_.convertUrlToKey(window.location.href,!0),d=this.stores_.history.getBuffer(h);d&&"number"==typeof d.scrollX?a(d.scrollX,d.scrollY):this.stores_.history.get(h,function(e){d=e.target.result,d&&"number"==typeof d.scrollX&&c.model_.compareKeyByUrl(h,c.util_.canonicalizeUrl(window.location.href))&&a(d.scrollX,d.scrollY)})},h.prototype.saveScrollPosition=function(a,c,h){void 0===a&&(a=window.location.href),void 0===c&&(c=jQuery(window).scrollLeft()),void 0===h&&(h=jQuery(window).scrollTop());var d=this.model_.convertUrlToKey(a,!0),e={url:d,scrollX:c,scrollY:h,date:(new Date).getTime(),title:undefined,host:undefined,expires:undefined};this.stores_.history.set(e,!0)},h.prototype.loadExpires=function(){},h.prototype.saveExpires=function(a,c,h){var d=this.model_.convertUrlToKey(a,!0),e={url:d,host:c||"",expires:h,title:undefined,scrollX:undefined,scrollY:undefined,date:undefined};this.stores_.history.set(e,!0)},h.prototype.getServerBuffers=function(){return this.stores_.server.getBuffers()},h.prototype.getServerBuffer=function(a){var c=this.model_.convertUrlToKey(a,!0).split("//").pop().split("/").shift();return c=this.model_.compareKeyByUrl("http://"+c,"http://"+window.location.host)?"":c,this.stores_.server.getBuffer(c)},h.prototype.loadServer=function(){},h.prototype.saveServer=function(a,c,h,d,e){a=a.split("//").pop().split("/").shift(),a=this.model_.compareKeyByUrl("http://"+a,"http://"+window.location.host)?"":a;var f={host:a,time:Math.max(h,1),score:d,state:e,expires:c};
    this.stores_.server.set(f,!0),this.stores_.server.clean()},h.prototype.removeServer=function(a){this.stores_.server.remove(a),this.stores_.server.clean()},h}();c.Data=h}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h=function(){function c(c){this.data_=c,this.util_=a.LIBRARY.Utility,this.force_=!1,this._host="",this.parallel_=4}return c.prototype.host_=function(a,c){return c&&(this._host=c.balance.active?this.sanitize(a,c).split("//").pop().split("/").shift()||"":""),this._host},c.prototype.host=function(){return this.host_()},c.prototype.sanitize=function(a,c){if(!c)return"";var h;switch(a&&typeof a){case"string":h=a;break;case"object":var d=a;h=4===d.readyState&&d.getResponseHeader(c.balance.server.header)||d.host}return h=h||"",!/[\/?#"`^|\\<>{}\[\]\s]/.test(h)&&jQuery.grep(c.balance.bounds,function(a){return""===h||"*"===a||h===a||"."===a.charAt(0)&&a===h.slice(-a.length)}).length&&h||""},c.prototype.enable=function(a){return a.balance.active&&a.balance.client.support.browser.test(window.navigator.userAgent)?(this.data_.setCookie(a.balance.client.cookie.balance,"1"),void(a.balance.client.support.redirect.test(window.navigator.userAgent)&&this.data_.setCookie(a.balance.client.cookie.redirect,"1"))):void this.disable(a)},c.prototype.disable=function(a){this.data_.getCookie(a.balance.client.cookie.balance)&&this.data_.setCookie(a.balance.client.cookie.balance,"0"),this.data_.getCookie(a.balance.client.cookie.redirect)&&this.data_.setCookie(a.balance.client.cookie.redirect,"0"),this.changeServer("",a)},c.prototype.score=function(a,c){return Math.max(Math.round(c/a*1e3),0)},c.prototype.changeServer=function(a,c){return c.balance.active?(this.host_(a,c),this.data_.setCookie(c.balance.client.cookie.host,a)):this.host_("",c),this.host()},c.prototype.chooseServers_=function(a){function c(a,c){return+c-+a}var h=this,d=a.balance.server.respite,e=a.balance.weight,f=a.ajax.timeout,_=a.balance.client.hosts.slice();_=this.force_?jQuery.grep(_,function(a){return!!a}):_,function(){var c=h.data_.getCookie(a.balance.client.cookie.host);(!h.force_||c)&&(c===h.sanitize(c,a)?!~jQuery.inArray(c,_)&&_.unshift(c):h.data_.setCookie(a.balance.client.cookie.host,""))}();var y=this.data_.getServerBuffers(),i={};jQuery.each(Object.keys(y),function(c,d){var e=y[d];~jQuery.inArray(e.host,_)&&_.splice(jQuery.inArray(e.host,_),1),(!h.force_||e.host)&&(e.host===h.sanitize(e.host,a)&&e.expires>(new Date).getTime()?i[e.score]=e:h.data_.removeServer(e.host))});var v,g=Object.keys(i).sort(c),l=[];for(jQuery.each(g,function(c){var y=i[g[c]],m=y.host,n=y.time,o=y.score,p=y.state;if(~jQuery.inArray(m,_)&&_.splice(jQuery.inArray(m,_),1),!(p+d>=(new Date).getTime())){switch(p&&h.data_.removeServer(y.host),!0){case l.length>=a.balance.random&&0<l.length:return!1;case e&&!m&&!!Math.floor(Math.random()*e):case f&&n>=f:case l.length>=Math.min(Math.floor(g.length/2),3)&&v&&n>=v.time+500&&f&&n>=2*f/3:case l.length>=Math.min(Math.floor(g.length/2),3)&&v&&o<=v.score/2:return}v=v||y,l.push(m)}});_.length;)l.push(_.splice(Math.floor(Math.random()*_.length),1).shift());return l},c.prototype.chooseServerFromCache_=function(a){var c=this,h=[],d=this.data_.getHistoryBuffer(a.destLocation.href);switch(!0){case!d:break;case d.host!==this.sanitize(d.host,a):this.data_.saveExpires(d.url,"",0);case!d.expires:case d.expires<(new Date).getTime():case this.force_&&!d.host:break;default:h=jQuery.map(this.data_.getServerBuffers(),function(a){return a.host===d.host?a.state>=(new Date).getTime()?void c.data_.saveExpires(d.url,d.host,0):a.host:void 0})}return h.length?h.pop()||" ":""},c.prototype.chooseServerFromScore_=function(a){var c=this.chooseServers_(a);return c.slice(Math.floor(Math.random()*Math.min(c.length,6))).shift()||" "},c.prototype.chooseServer=function(a){return a.balance.active?this.util_.trim(this.chooseServerFromCache_(a)||this.chooseServerFromScore_(a)):""},c.prototype.bypass=function(a){var c=this;this.force_=!0;var h=jQuery.Deferred();if(!a||!a.balance.active)return h.reject();var d=this.parallel_,e=this.chooseServers_(a),f=jQuery.extend({},a.ajax,a.balance.option.ajax);e=jQuery.grep(e,function(a){return!!a});for(var _=0,y=e.length,i=function(d){var v=c,g=(new Date).getTime();"pending"===h.state()&&jQuery.ajax(jQuery.extend({},f,{url:v.util_.normalizeUrl(window.location.protocol+"//"+d+window.location.pathname.replace(/^\/?/,"/")+window.location.search),xhr:a.balance.option.callbacks.ajax.xhr?function(){var c;return c=v.util_.fire(a.balance.option.callbacks.ajax.xhr,this,[event,a]),c="object"==typeof c?c:jQuery.ajaxSettings.xhr()}:undefined,beforeSend:a.balance.option.callbacks.ajax.beforeSend||a.server.header?function(c,h){a.server.header&&c.setRequestHeader(a.nss.requestHeader,"true"),"object"==typeof a.server.header&&(c.setRequestHeader(a.nss.requestHeader,"true"),a.server.header.area&&c.setRequestHeader(a.nss.requestHeader+"-Area",this.app_.chooseArea(a.area,document,document)),a.server.header.head&&c.setRequestHeader(a.nss.requestHeader+"-Head",a.load.head),a.server.header.css&&c.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css.toString()),a.server.header.script&&c.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script.toString())),v.util_.fire(a.balance.option.callbacks.ajax.beforeSend,this,[event,a,c,h])}:undefined,dataFilter:a.balance.option.callbacks.ajax.dataFilter?function(c,h){return v.util_.fire(a.balance.option.callbacks.ajax.dataFilter,this,[event,a,c,h])||c}:undefined,success:function(c,h,e){g=(new Date).getTime()-g;var f=v.data_.getServerBuffer(this.url),_=v.score(g,e.responseText.length);g=f&&!f.state&&f.time?Math.round((f.time+g)/2):g,_=f&&!f.state&&f.score?Math.round((f.score+_)/2):_,v.data_.saveServer(d,(new Date).getTime()+a.balance.server.expires,g,_,0),d=v.sanitize(e,a)||d,v.util_.fire(a.balance.option.ajax.success,this,arguments)},error:function(){v.data_.saveServer(d,(new Date).getTime()+a.balance.server.expires,0,0,(new Date).getTime()),d=null,v.util_.fire(a.balance.option.ajax.error,this,arguments)},complete:function(){v.util_.fire(a.balance.option.ajax.complete,this,arguments),++_,h.notify(_,y,d),d?(v.host_(d,a),e.splice(0,e.length),h.resolve(d)):!v.host()&&e.length?i(e.shift()):h.reject()}}))};d--&&e.length;)i(e.shift());return h},c}();c.Balancer=h}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c=function(){function a(a,c,d,e,f,_){this.data_=a?{url:a,data:c,textStatus:d,jqXHR:e,host:f,bind:_}:{url:undefined,data:undefined,textStatus:undefined,jqXHR:undefined,host:undefined,bind:undefined},this.data=new h(this.data_)}return a.prototype.state=function(a){var c=a?a.cache.expires.min:undefined,h=a?a.cache.expires.max:undefined;switch(!1){case this.data.jqXHR()&&200===+this.data.jqXHR().status:case this.data.expires(c,h)>=(new Date).getTime():return!1;default:return!0}},a}();a.PageRecord=c;var h=function(){function a(a){this.data_=a}return a.prototype.url=function(){return this.data_.url},a.prototype.data=function(){return this.data_.data},a.prototype.textStatus=function(){return this.data_.textStatus},a.prototype.jqXHR=function(){return this.data_.jqXHR},a.prototype.bind=function(){return this.data_.bind},a.prototype.host=function(){return this.data_.host},a.prototype.expires=function(a,c){if(!this.jqXHR()&&!this.data())return 0;var h,d=this.jqXHR();switch(d&&(d.timeStamp=d.timeStamp||new Date(d.getResponseHeader("Date")).getTime()||(new Date).getTime()),!0){case!d:h=0;break;case/no-store|no-cache/.test(d.getResponseHeader("Cache-Control")):h=0;break;case!!d.getResponseHeader("Cache-Control")&&!!~d.getResponseHeader("Cache-Control").indexOf("max-age="):h=new Date(d.getResponseHeader("Date")||new Date(d.timeStamp).toString()).getTime()+1e3*+d.getResponseHeader("Cache-Control").match(/max-age=(\d*)/).pop();break;case!!d.getResponseHeader("Expires"):h=new Date(d.getResponseHeader("Expires")).getTime();break;default:h=0}return(undefined!==a||undefined!==c)&&(h="number"==typeof a?Math.max(a+(new Date).getTime(),h):h,h="number"==typeof c?Math.min(c+(new Date).getTime(),h):h),h=Math.max(h,0)||0},a}();a.PageRecordData=h}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c=function(){function a(){}return a.prototype.chooseArea=function(a,c,h,d){void 0===d&&(d=!0);var e="string"==typeof a?[a]:a;e:for(var f=0;f<e.length;f++){for(var _=e[f],y=_.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[_],i=y.length;i--;){var v=y[i];switch(!0){case 0===jQuery(v,c).length:case jQuery(v,c).length!==jQuery(v,h).length:continue e}}return _}return""},a.prototype.dispatchEvent=function(a,c,h,d){var e=document.createEvent("HTMLEvents");e.initEvent(c,h,d),a.dispatchEvent(e)},a}();a.PageUtility=c}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h=function(){function c(c,h,d,e,f,_,y){this.model_=c,this.page_=h,this.balancer_=d,this.setting_=e,this.event_=f,this.success_=_,this.failure_=y,this.util_=a.LIBRARY.Utility,this.binds_=[],this.jsons_=[],this.main_()}return c.prototype.main_=function(){function c(){return e.call(this,[].slice.call(arguments),undefined)}function h(){return f.apply(this,arguments)}function d(){return _.apply(this,arguments)}function e(a,c,h){void 0===h&&(h=[]),arguments.length&&arguments[0]&&(y.data_=a[0],y.textStatus_=a[1],y.jqXHR_=a[2],y.binds_=h.every(function(a){return!!a&&"object"==typeof a})?h:[h[2]],y.util_.fire(i.callbacks.ajax.success,this[0]||this,[v,i,y.data_,y.textStatus_,y.jqXHR_]))}function f(a,c,h){arguments.length&&arguments[0]&&(y.jqXHR_=a,y.textStatus_=c,y.errorThrown_=h,y.binds_=[],y.util_.fire(i.callbacks.ajax.error,this[0]||this,[v,i,y.jqXHR_,y.textStatus_,y.errorThrown_]))}function _(){arguments.length&&arguments[0]&&(y.util_.fire(i.callbacks.ajax.complete,this[0]||this,[v,i,y.jqXHR_,y.textStatus_]),y.model_.setPageXHR(null),y.model_.setDataXHR(null),200===+y.jqXHR_.status&&y.binds_.every(function(a){return 200===+a.status})?(y.binds_.forEach(function(a,c){return y.binds_[c].responseJSON=y.binds_[c].responseJSON||y.jsons_[c]}),y.model_.setCache(i.destLocation.href,n&&n.data||null,y.textStatus_,y.jqXHR_),y.success_(i,v,y.data_,y.textStatus_,y.jqXHR_,y.host_,y.binds_)):y.failure_(i,v,y.data_,y.textStatus_,y.jqXHR_,y.host_,y.binds_))}var y=this,i=this.setting_,v=this.event_=jQuery.extend(!0,{},this.event_),g=this.util_.fire(i.wait,i,[v,i,i.origLocation.cloneNode(),i.destLocation.cloneNode()]),l=i.speedcheck,m=this.model_.speed;l&&(m.fire=v.timeStamp),l&&m.time.splice(0,100,0),l&&m.name.splice(0,100,"pjax("+m.time.slice(-1)+")");var n;switch(i.cache[v.type.toLowerCase()]&&v.type.toLowerCase()){case a.EVENT.CLICK:n=this.model_.getCache(i.destLocation.href);break;case a.EVENT.SUBMIT:n=i.cache[v.currentTarget.method.toLowerCase()]?this.model_.getCache(i.destLocation.href):n;break;case a.EVENT.POPSTATE:n=this.model_.getCache(i.destLocation.href)}var o=this.model_.getPageXHR();if(!(o&&o.readyState<4&&o.location&&this.model_.comparePageByUrl(o.location.href,i.destLocation.href)))if(this.dispatchEvent(document,i.nss.event.pjax.fetch,!1,!1),n&&n.jqXHR&&200===+n.jqXHR.status)if(l&&m.name.splice(0,1,"cache("+m.time.slice(-1)+")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(i.bind,i,[v,i,i.origLocation.cloneNode(),i.destLocation.cloneNode()]))),o=n.jqXHR,o.location=o.location||i.destLocation.cloneNode(),this.model_.setPageXHR(o),this.page_.loadtime=0,this.host_=this.balancer_.sanitize(n.host,i),this.data_=n.jqXHR.responseText,this.textStatus_=n.textStatus,this.jqXHR_=n.jqXHR,this.model_.isDeferrable){var p=this.wait_(g);this.page_.setWait(p),jQuery.when(jQuery.Deferred().resolve(this.data_,this.textStatus_,this.jqXHR_),p,jQuery.when.apply(null,this.model_.getDataXHR())).done(e).fail(f).always(_)}else{var q=jQuery.extend({},jQuery.ajaxSettings,i.ajax);q=q.context||q,c.call(q,this.data_,this.textStatus_,this.jqXHR_),d.call(q,this.jqXHR_,this.textStatus_)}else if(o&&o.follow&&!~"error abort timeout parsererror".indexOf(o.statusText)){l&&m.time.splice(0,1,o.timeStamp-m.fire),l&&m.name.splice(0,1,"preload("+m.time.slice(-1)+")"),l&&m.time.push(m.now()-m.fire),l&&m.name.push("continue("+m.time.slice(-1)+")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(i.bind,i,[v,i,i.origLocation.cloneNode(),i.destLocation.cloneNode()]))),o.location=i.destLocation.cloneNode(),this.model_.setPageXHR(o),this.host_=this.model_.host(),this.page_.loadtime=o.timeStamp;var p=this.wait_(g);this.page_.setWait(p),delete o.timeStamp,jQuery.when(o,p,jQuery.when.apply(null,this.model_.getDataXHR())).done(e).fail(f).always(_)}else{this.page_.loadtime=v.timeStamp;var r={};this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(i.bind,i,[v,i,i.origLocation.cloneNode(),i.destLocation.cloneNode()])));var s=this.balance_(i.destLocation.href);switch(r.url=i.server.query?[s.protocol,"//",s.host,s.pathname.replace(/^\/?/,"/"),s.search.replace(/&*$/,"&"+i.server.query).replace(/^\??&/,"?").replace(/(\?|&)$/,""),s.hash].join(""):s.href,v.type.toLowerCase()){case a.EVENT.CLICK:r.type="GET";break;case a.EVENT.SUBMIT:switch(r.type=v.currentTarget.method.toUpperCase(),r.type){case"POST":jQuery(v.currentTarget).has(":file").length?"function"==typeof FormData&&(r.data=(new FormData)(v.currentTarget),r.contentType=!1,r.processData=!1):r.data=jQuery(v.currentTarget).serializeArray();break;case"GET":}break;case a.EVENT.POPSTATE:r.type="GET"}if(r=jQuery.extend({},i.ajax,r,{xhr:i.callbacks.ajax.xhr?function(){var a;return a=y.util_.fire(i.callbacks.ajax.xhr,this,[v,i]),a="object"==typeof a?a:jQuery.ajaxSettings.xhr()}:undefined,beforeSend:i.callbacks.ajax.beforeSend||i.server.header?function(a,c){i.server.header&&a.setRequestHeader(i.nss.requestHeader,"true"),"object"==typeof i.server.header&&(a.setRequestHeader(i.nss.requestHeader,"true"),i.server.header.area&&a.setRequestHeader(i.nss.requestHeader+"-Area",this.app_.chooseArea(i.area,document,document)),i.server.header.head&&a.setRequestHeader(i.nss.requestHeader+"-Head",i.load.head),i.server.header.css&&a.setRequestHeader(i.nss.requestHeader+"-CSS",i.load.css.toString()),i.server.header.script&&a.setRequestHeader(i.nss.requestHeader+"-Script",i.load.script.toString())),y.util_.fire(i.callbacks.ajax.beforeSend,this,[v,i,a,c])}:undefined,dataFilter:i.callbacks.ajax.dataFilter?function(a,c){return y.util_.fire(i.callbacks.ajax.dataFilter,this,[v,i,a,c])||a}:undefined,success:this.model_.isDeferrable?null:c,error:this.model_.isDeferrable?null:h,complete:this.model_.isDeferrable?null:d}),o=jQuery.ajax(r),o.location=i.destLocation.cloneNode(),this.model_.setPageXHR(o),!this.model_.isDeferrable)return;var p=this.wait_(g);this.page_.setWait(p),jQuery.when(this.model_.getPageXHR(),p,jQuery.when.apply(null,this.model_.getDataXHR())).done(e).fail(f).always(_)}},c.prototype.balance_=function(a){var c=(this.setting_,document.createElement("a"));return c.href=a,c.host=this.host_||c.host,c},c.prototype.bind_=function(a){var c=this;return(a||[]).map(function(a){return a.url=c.util_.canonicalizeUrl(a.url),a.url.indexOf("//")>-1?a:(a.url=c.balance_(a.url).href,a)}).map(jQuery.ajax).map(function(a,h){return a.done(function(a,d,e){var f=a;switch(e.getResponseHeader("Content-Type").split("/").pop()){case"json":if(e.responseJSON)break;if(c.jsons_[h])for(var _ in f)c.jsons_[h][_]=f[_];else c.jsons_[h]=f}})})},c.prototype.wait_=function(a){var c=jQuery.Deferred();return a?(setTimeout(function(){c.resolve()},a),c):c.resolve()},c.prototype.chooseArea=function(){},c.prototype.dispatchEvent=function(){},c}();c.PageFetch=h}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){var c;!function(a){var c=function(){function c(c,h,d,e){this.Record_=c,this.model_=h,this.balancer_=d,this.page_=e,this.hash_=function(a){return a.nss.url},this.table_={},this.order_=[],this.fetch_=a.PageFetch}return c.prototype.fetchRecord=function(a,c,h,d){this.getRecord(a).state(a)?this.pullRecord(a,c,h,d):this.pullRecord(a,c,h,d)},c.prototype.pullRecord=function(a,c,h,d){var e=this;new this.fetch_(this.model_,this.page_,this.balancer_,a,c,function(a,c,d,f,_,y,i){var v=e.setRecord(a,e.getRecord(a).data.data()||"",f,_,y,i);h(v,a,c)},function(a,c,h,f,_,y,i){var v=e.setRecord(a,e.getRecord(a).data.data()||"",f,_,y,i);d(v,a,c)})},c.prototype.getRecord=function(a){return this.table_[this.hash_(a)]=this.table_[this.hash_(a)]||new this.Record_},c.prototype.setRecord=function(a,c,h,d,e,f){return this.cleanRecords_(a),this.addOrder_(a),this.table_[this.hash_(a)]=new this.Record_(a.nss.url,c,h,d,e,f)},c.prototype.removeRecord=function(a){return this.removeOrder_(a),this.table_[this.hash_(a)]=new this.Record_},c.prototype.clearRecord=function(){this.order_.splice(0,this.order_.length);for(var a in this.table_)delete this.table_[a]},c.prototype.cleanRecords_=function(a){if(a.cache.limit)for(;this.order_.length>=a.cache.limit;)this.removeRecord(this.order_.pop())},c.prototype.addOrder_=function(a){this.removeOrder_(a),this.order_.unshift(a)},c.prototype.removeOrder_=function(a){for(var c=this.order_.length;c--;)this.order_[c].nss.url===a.nss.url&&this.order_.splice(c,1)},c}();a.PageProvider=c}(c=a.APP||(a.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h=function(){function c(c,h,d,e,f,_,y){this.model_=c,this.page_=h,this.data_=d,this.balancer_=e,this.setting_=f,this.event_=_,this.record_=y,this.util_=a.LIBRARY.Utility,this.loadwaits_=[],this.main_()}return c.prototype.main_=function(){var c=this.record_,h=this.setting_,d=this.event_,e=h.speedcheck,f=this.model_.speed;if(e&&f.time.push(f.now()-f.fire),e&&f.name.push("fetch("+f.time.slice(-1)+")"),++this.page_.count,this.page_.loadtime=this.page_.loadtime&&(new Date).getTime()-this.page_.loadtime,h.cache.mix&&a.EVENT.POPSTATE!==d.type.toLowerCase()&&(new Date).getTime()-d.timeStamp<=h.cache.mix)return this.model_.fallback(d);try{if(this.page_.landing=null,!~(c.data.jqXHR().getResponseHeader("Content-Type")||"").toLowerCase().search(h.contentType))throw new Error("throw: content-type mismatch");if(this.srcTitle_=jQuery(c.data.jqXHR().responseText.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i).pop()).text(),this.dstTitle_=document.title,this.redirect_(),this.blur_(),this.dispatchEvent(window,h.nss.event.pjax.unload,!1,!1),this.url_(),!this.model_.comparePageByUrl(h.destLocation.href,window.location.href))throw new Error("throw: location mismatch");this.document_()}catch(_){if(!_)return;this.model_.getCache(window.location.href)&&this.model_.removeCache(h.destLocation.href),this.model_.fallback(d)}},c.prototype.isRegister_=function(c,h){if(c.destLocation.href===c.origLocation.href)return!1;switch(h.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:return!0;case a.EVENT.POPSTATE:return!1}},c.prototype.isReplace_=function(c,h){switch(h.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:return jQuery(h.currentTarget).is(c.replace);case a.EVENT.POPSTATE:return!1}},c.prototype.isCacheUsable_=function(c,h){switch(!0){case!h.cache.click&&!h.cache.submit&&!h.cache.popstate:case a.EVENT.SUBMIT===c.type.toLowerCase()&&!h.cache[c.currentTarget.method.toLowerCase()]:return!1;default:return!0}},c.prototype.redirect_=function(){var c=this,h=this.setting_,d=this.event_,e=(jQuery('head meta[http-equiv="Refresh"][content*="URL="]').attr("content")||"").match(/\w+:\/\/[^;\s"']+|$/i).shift();if(e&&!this.model_.comparePageByUrl(h.destLocation.href,e)){var f=h.destLocation.cloneNode();if(f.href=e,this.util_.fire(h.callbacks.update.redirect.before,h,[d,h,f.cloneNode(),h.origLocation.cloneNode(),h.destLocation.cloneNode()])!==!1){switch(!0){case!h.redirect:case f.protocol!==h.destLocation.protocol:case f.host!==h.destLocation.host:case a.EVENT.SUBMIT===d.type.toLowerCase()&&"GET"!==d.currentTarget.method.toUpperCase():switch(d.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:window.location.assign(f.href);break;case a.EVENT.POPSTATE:window.location.replace(f.href)}throw!1;default:switch(jQuery[a.DEF.NAME].enable(),d.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:setTimeout(function(){return jQuery[a.DEF.NAME].click(f.href)},0);break;case a.EVENT.POPSTATE:window.history.replaceState(window.history.state,this.srcTitle_,f.href),this.isRegister_(h,d)&&h.fix.location&&!this.util_.compareUrl(h.destLocation.href,window.location.href)&&(jQuery[a.DEF.NAME].disable(),window.history.back(),window.history.forward(),jQuery[a.DEF.NAME].enable()),setTimeout(function(){return c.dispatchEvent(window,a.EVENT.POPSTATE,!1,!1)},0)}throw!1}this.util_.fire(h.callbacks.update.redirect.after,h,[d,h,f.cloneNode(),h.origLocation.cloneNode(),h.destLocation.cloneNode()])===!1}}},c.prototype.blur_=function(){var a=this.setting_,c=this.event_;this.util_.fire(a.callbacks.update.blur.before,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])!==!1&&(jQuery(document.activeElement).not("body").blur(),this.util_.fire(a.callbacks.update.blur.after,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])===!1)},c.prototype.url_=function(){var c=this.setting_,h=this.event_;this.model_.location.href=c.destLocation.href,this.util_.fire(c.callbacks.update.url.before,c,[h,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()])!==!1&&(this.isReplace_(c,h)?(window.history.replaceState(this.util_.fire(c.state,c,[h,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]),this.srcTitle_,c.destLocation.href),c.fix.location&&!this.util_.compareUrl(c.destLocation.href,window.location.href)&&window.location.replace(c.destLocation.href)):this.isRegister_(c,h)&&(window.history.pushState(this.util_.fire(c.state,c,[h,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]),~window.navigator.userAgent.toLowerCase().indexOf("opera")?this.dstTitle_:this.srcTitle_,c.destLocation.href),c.fix.location&&!this.util_.compareUrl(c.destLocation.href,window.location.href)&&(jQuery[a.DEF.NAME].disable(),window.history.back(),window.history.forward(),jQuery[a.DEF.NAME].enable())),this.util_.fire(c.callbacks.update.url.after,c,[h,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()])===!1)},c.prototype.document_=function(){var c=this,h=this.setting_,d=this.event_;if(h.load.script&&!this.page_.loadedScripts[""]){var e=this.page_.loadedScripts;e[""]=!0,jQuery("script").each(function(){var a=this;a.src&&(e[a.src]=!h.load.reload||!jQuery(a).is(h.load.reload))})}this.srcDocument_=this.page_.parser.parse(this.record_.data.jqXHR().responseText,h.destLocation.href),this.dstDocument_=document;var f=h.speedcheck,_=this.model_.speed;if(f&&_.time.push(_.now()-_.fire),f&&_.name.push("parse("+_.time.slice(-1)+")"),this.area_=this.chooseArea(h.area,this.srcDocument_,this.dstDocument_),!this.area_)throw new Error("throw: area notfound");this.areas_=this.area_.match(/(?:[^,]+?|\(.*?\)|\[.*?\])+/g),this.overwriteDocumentByCache_(),h.fix.noscript&&this.escapeNoscript_(this.srcDocument_),h.fix.reference&&this.fixReference_(h.origLocation.href,this.dstDocument_),this.rewrite_(),this.title_(),h.fix.history&&this.data_.saveTitle(),this.data_.saveExpires(this.record_.data.url(),this.record_.data.host(),this.record_.data.expires()),this.head_(),f&&_.time.push(_.now()-_.fire),f&&_.name.push("head("+_.time.slice(-1)+")"),this.content_(),this.focus_(),this.dispatchEvent(document,h.nss.event.pjax.DOMContentLoaded,!1,!1),f&&_.time.push(_.now()-_.fire),f&&_.name.push("content("+_.time.slice(-1)+")"),this.balance_(),this.css_('link[rel~="stylesheet"], style'),jQuery(window).one(a.DEF.NAME+":rendering",function(e){e.preventDefault(),e.stopImmediatePropagation();var y=function(a){return c.model_.comparePageByUrl(h.destLocation.href,window.location.href)?(c.dispatchEvent(document,h.nss.event.pjax.ready,!1,!1),jQuery(c.area_).each(function(a,c){return jQuery(c).width()}),jQuery.when?jQuery.Deferred().resolve():a()):void 0},i=function(e){return c.model_.comparePageByUrl(h.destLocation.href,window.location.href)?(c.util_.fire(h.callback,h,[d,h]),setTimeout(function(){switch(d.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:c.model_.overlay(h)||c.scrollByHash_(h)||c.scroll_(!0);break;case a.EVENT.POPSTATE:c.model_.overlay(h)||c.scroll_(!0)}},100),c.dispatchEvent(document,h.nss.event.pjax.render,!1,!1),f&&_.time.push(_.now()-_.fire),f&&_.name.push("render("+_.time.slice(-1)+")"),jQuery.when?jQuery.when.apply(jQuery,c.loadwaits_):e()):void 0},v=function(){return c.model_.comparePageByUrl(h.destLocation.href,window.location.href)?(c.dispatchEvent(window,h.nss.event.pjax.load,!1,!1),f&&_.time.push(_.now()-_.fire),f&&_.name.push("load("+_.time.slice(-1)+")"),c.script_("[src][defer]"),jQuery.when&&jQuery.Deferred().resolve()):jQuery.when&&jQuery.Deferred().reject()};if(c.scroll_(!1),100>c.page_.loadtime&&h.reset.type.match(d.type.toLowerCase())&&!jQuery('form[method][method!="GET"]').length)switch(!1){case c.page_.count<h.reset.count||!h.reset.count:case(new Date).getTime()<h.reset.time+c.page_.time||!h.reset.time:throw new Error("throw: reset")}var g=c.script_(":not([defer]), :not([src])");if(jQuery.when){var l=jQuery.Deferred().pipe?"pipe":"then";jQuery.when.apply(jQuery,g)[l](function(){return y()})[l](function(){return i()})[l](function(){return v()})}else y(function(){return i(function(){return v()})})}).trigger(a.DEF.NAME+":rendering")},c.prototype.overwriteDocumentByCache_=function(){var a=this.setting_,c=this.event_,h=this.model_.getCache(a.destLocation.href);if(this.isCacheUsable_(c,a)&&h&&h.data){var d=a.fix.noscript?this.restoreNoscript_(h.data):h.data,e=this.page_.parser.parse(d,a.destLocation.href),f=this.srcDocument_;f.title=e.title;for(var _,y,i=0;this.areas_[i];i++){if(_=jQuery(this.areas_[i],e).clone(),y=jQuery(this.areas_[i],f),!_.length||!y.length||_.length!==y.length)throw new Error("throw: area mismatch");for(var v=0;_[v];v++)y[v].parentNode.replaceChild(_[v],y[v])}}},c.prototype.rewrite_=function(){function a(a){if(!a)return{};switch(a.getResponseHeader("Content-Type").split("/").pop()){case"json":return a.responseJSON}}var c=this.setting_,h=this.event_;c.rewrite&&this.util_.fire(c.callbacks.update.rewrite.before,c,[h,c,this.srcDocument_,this.dstDocument_])!==!1&&(this.util_.fire(c.rewrite,c,[this.srcDocument_,this.area_,this.record_.data.host(),this.record_.data.bind().map(a)]),this.util_.fire(c.callbacks.update.rewrite.before,c,[h,c,this.srcDocument_,this.dstDocument_])===!1)},c.prototype.title_=function(){var a=this.setting_,c=this.event_;this.util_.fire(a.callbacks.update.title.before,a,[c,a,this.srcDocument_.title,this.dstDocument_.title])!==!1&&(this.dstDocument_.title=this.srcDocument_.title,this.util_.fire(a.callbacks.update.title.after,a,[c,a,this.srcDocument_.title,this.dstDocument_.title])===!1)},c.prototype.head_=function(){var a=this.setting_,c=this.event_,h=this.srcDocument_,d=this.dstDocument_;if(a.load.head&&this.util_.fire(a.callbacks.update.head.before,a,[c,a,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])!==!1){for(var e,f="base, meta, link",_=jQuery(h.head).children(f).filter(a.load.head).not(a.load.ignore).not('link[rel~="stylesheet"], style, script'),y=jQuery(d.head).children(f).filter(a.load.head).not(a.load.ignore).not('link[rel~="stylesheet"], style, script'),i=jQuery(),v=y,g=0;e=_[g];g++){for(var l=0;v[l];l++)if(v[l].tagName===e.tagName&&v[l].outerHTML===e.outerHTML){if(i.length){var m=y[y.index(v[l])-1];m?jQuery(m).after(i.clone()):v.eq(l).before(i.clone()),i=jQuery()}v=v.not(v[l]),e=null;break}i=i.add(e)}jQuery("title",d).before(i.clone()),v.remove(),this.util_.fire(a.callbacks.update.head.after,a,[c,a,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])===!1}},c.prototype.content_=function(){function a(){if(jQuery.Deferred){var a=jQuery.Deferred();switch(this.tagName.toLowerCase()){case"img":jQuery(this).one("load error abort",a.resolve);break;case"iframe":case"frame":jQuery(this).one("load",a.resolve)}return a}}var c=this,h=this.setting_,d=this.event_,e=this.srcDocument_,f=this.dstDocument_;if(this.util_.fire(h.callbacks.update.content.before,h,[d,h,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])!==!1){jQuery(this.area_).children("."+h.nss.elem+"-check").remove();for(var _,y,i=0;this.areas_[i];i++){if(_=jQuery(this.areas_[i],e),y=jQuery(this.areas_[i],f),!_.length||!y.length||_.length!==y.length)throw new Error("throw: area mismatch");_=_.map(function(a,c){return document.importNode(c,!0)}),_.find("script").each(function(a,h){return c.escapeScript_(h)}),this.loadwaits_=this.loadwaits_.concat(_.find("img, iframe, frame").map(a).get());for(var v=0;_[v];v++)y[v].parentNode.replaceChild(_[v],y[v]),document.body===_[v]&&(jQuery.each(_[v].attributes,function(a,c){return y[v].removeAttribute(c.name)}),jQuery.each(_[v].attributes,function(a,c){return y[v].setAttribute(c.name,c.value)}));y=jQuery(this.areas_[i],f),y.find("script").each(function(a,h){return c.restoreScript_(h)})}this.util_.fire(h.callbacks.update.content.after,h,[d,h,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])===!1}},c.prototype.focus_=function(){var a=this.setting_,c=this.event_;this.util_.fire(a.callbacks.update.focus.before,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])!==!1&&(jQuery("body, input[autofocus], textarea[autofocus]").last().not(document.activeElement).focus(),this.util_.fire(a.callbacks.update.focus.after,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])===!1)},c.prototype.balance_=function(){var a=this,c=this.setting_,h=this.event_;!c.balance.active||this.page_.loadtime<100||[this.record_.data.jqXHR()].concat(this.record_.data.bind()).forEach(function(d){var e=a.balancer_.sanitize(d,c)||a.record_.data.host()||"",f=a.page_.loadtime,_=a.balancer_.score(f,d.responseText.length);if(a.util_.fire(c.callbacks.update.balance.before,c,[h,c,e,a.page_.loadtime,d.responseText.length])!==!1){var y=a.data_.getServerBuffer(c.destLocation.href),_=a.balancer_.score(f,d.responseText.length);f=y&&!y.state&&y.time?Math.round((y.time+f)/2):f,_=y&&!y.state&&y.score?Math.round((y.score+_)/2):_,a.data_.saveServer(e,(new Date).getTime()+c.balance.server.expires,f,_,0),a.balancer_.changeServer(a.balancer_.chooseServer(c),c),a.util_.fire(c.callbacks.update.balance.after,c,[h,c,e,a.page_.loadtime,d.responseText.length])===!1}})},c.prototype.css_=function(a){function c(){return jQuery.contains(f.head,this)}function h(){return jQuery.contains(f.body,this)}var d=this.setting_,e=this.event_,f=this.srcDocument_,_=this.dstDocument_;if(d.load.css){var y="link, style",i=jQuery(y,f).filter(a).not(jQuery("noscript",f).find(y)),v=jQuery(y,_).filter(a).not(jQuery("noscript",f).find(y)),g=jQuery(),l=v;if(this.util_.fire(d.callbacks.update.css.before,d,[e,d,i.get(),v.get()])!==!1){i=i.not(d.load.ignore),v=i.not(d.load.ignore);for(var m,n=0;m=i[n];n++){for(var o,p=0;l[p];p++){switch(m.tagName.toLowerCase()){case"link":o=m.href===l[p].href;break;case"style":o=this.util_.trim(m.innerHTML)===this.util_.trim(l[p].innerHTML)}if(o){if(g.length){if(jQuery.contains(_.body,l[p])&&g.first().parents("head").length)jQuery(_.head).append(g.filter(c).clone()),l.eq(p).before(g.filter(h).clone());else{var q=v[v.index(l[p])-1];q?jQuery(q).after(g.clone()):l.eq(p).before(g.clone())}g=jQuery()}l=l.not(l[p]),p-=Number(!!p),m=null;break}}g=g.add(m)}if(jQuery(_.head).append(g.filter(c).clone()),jQuery(_.body).append(g.filter(h).clone()),l.remove(),v=jQuery(y,_).filter(a).not(jQuery("noscript",f).find(y)),this.util_.fire(d.callbacks.update.css.after,d,[e,d,i.get(),v.get()])!==!1){var r=d.speedcheck,s=this.model_.speed;r&&s.time.push(s.now()-s.fire),r&&s.name.push("css("+s.time.slice(-1)+")")
}}}},c.prototype.script_=function(a){var c=this,h=this.setting_,d=this.event_,e=this.srcDocument_,f=this.dstDocument_,_=[],y=[];if(!h.load.script)return _;var i="script",v=jQuery(i,e).filter(a).not(jQuery("noscript",e).find(i)),g=jQuery(i,f).filter(a).not(jQuery("noscript",f).find(i)),l=this.page_.loadedScripts,m=/^$|(?:application|text)\/(?:java|ecma)script/i,n=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;if(this.util_.fire(h.callbacks.update.script.before,h,[d,h,v.get(),g.get()])===!1)return _;v=v.not(h.load.ignore);for(var o,p=function(a,d){if(!c.model_.comparePageByUrl(h.destLocation.href,window.location.href))return!1;a.src&&(l[a.src]=!h.load.reload||!jQuery(a).is(h.load.reload));try{if(c.model_.isDeferrable){if("string"!=typeof d)throw d;eval.call(window,d)}else a.hasAttribute("src")?jQuery.ajax(jQuery.extend(!0,{},h.ajax,h.load.ajax,{url:a.src,dataType:"script",async:!1,global:!1,success:function(){return null},error:function(a){throw a}})):eval.call(window,(a.text||a.textContent||a.innerHTML||"").replace(n,""));try{a.hasAttribute("src")&&c.dispatchEvent(a,"load",!1,!1)}catch(e){}}catch(f){try{a.hasAttribute("src")&&c.dispatchEvent(a,"error",!1,!1)}catch(e){}if(!0===h.load.error)throw f;c.util_.fire(h.load.error,h,[f,a])}},q=0;o=v[q];q++)if(m.test(o.type||"")&&(o.hasAttribute("src")?!l[o.src]:this.util_.trim(o.innerHTML))){var r=jQuery(o).parent(h.load.log)[0];if(r&&!jQuery(o).parents(this.area_).length){var s=jQuery(r.id||r.tagName,f)[0],t=o.cloneNode(!0);this.escapeScript_(t),s.appendChild(t),this.restoreScript_(t)}!function(a){var d=c.model_.isDeferrable&&jQuery.Deferred();a.hasAttribute("src")&&a.getAttribute("src")?(l[a.src]=!h.load.reload||!jQuery(a).is(h.load.reload),a.hasAttribute("async")?jQuery.ajax(jQuery.extend({},h.ajax,h.load.ajax,{url:a.src,dataType:"script",async:!0,global:!1,success:function(){return c.dispatchEvent(a,"load",!1,!1)},error:function(){return c.dispatchEvent(a,"error",!1,!1)}})):d?(jQuery.ajax(jQuery.extend({},h.ajax,h.load.ajax,{url:a.src,dataType:"text",async:!0,global:!1,success:function(c){return d.resolve([a,c])},error:function(c){return d.resolve([a,c])}})),_.push(d)):y.push(a)):a.hasAttribute("src")||(d?_.push(d.resolve([a,(a.text||a.textContent||a.innerHTML||"").replace(n,"")])):y.push(a))}(o)}try{this.model_.isDeferrable?jQuery.when.apply(jQuery,_).always(function(){for(var a=[],h=0;h<arguments.length;h++)a[h-0]=arguments[h];return jQuery.each(a,function(a,h){return p.apply(c,h)})}):jQuery.each(y,function(a,c){return p(c)})}catch(u){throw setTimeout(function(){return c.model_.fallback(d)},1),u}if(g=jQuery(i,f).filter(a).not(jQuery("noscript",f).find(i)),this.util_.fire(h.callbacks.update.script.after,h,[d,h,v.get(),g.get()])===!1)return _;var E=h.speedcheck,b=this.model_.speed;return E&&b.time.push(b.now()-b.fire),E&&b.name.push("script("+b.time.slice(-1)+")"),_},c.prototype.scroll_=function(c){var h=this.setting_,d=this.event_;if(this.util_.fire(h.callbacks.update.scroll.before,h,[d,h])!==!1){var e,f;switch(d.type.toLowerCase()){case a.EVENT.CLICK:case a.EVENT.SUBMIT:e=c&&"function"==typeof h.scrollLeft?this.util_.fire(h.scrollLeft,h,[d,h,h.origLocation.cloneNode(),h.destLocation.cloneNode()]):h.scrollLeft,e=e>=0?e:0,e=e===!1||null===e?jQuery(window).scrollLeft():parseInt(Number(e)+"",10),f=c&&"function"==typeof h.scrollTop?this.util_.fire(h.scrollTop,h,[d,h,h.origLocation.cloneNode(),h.destLocation.cloneNode()]):h.scrollTop,f=f>=0?f:0,f=f===!1||null===f?jQuery(window).scrollTop():parseInt(Number(f)+"",10),window.scrollTo(e,f);break;case a.EVENT.POPSTATE:c&&h.fix.scroll&&this.data_.loadScrollPosition()}c&&this.data_.saveScrollPosition(),this.util_.fire(h.callbacks.update.scroll.after,h,[d,h])===!1}},c.prototype.scrollByHash_=function(a){var c=a.destLocation.hash.replace(/^#/,"");if(!c)return!1;var h=jQuery("#"+c+", [name~="+c+"]").first();return h.length?(isFinite(h.offset().top)&&window.scrollTo(jQuery(window).scrollLeft(),parseInt(Number(h.offset().top)+"",10)),this.data_.saveScrollPosition(),!0):!1},c.prototype.fixReference_=function(a,c){function h(a,c){var h;switch(!0){case"href"in c:h="href";break;case"src"in c:h="src";break;default:return}switch(d){case 0:break;case 1:c[h]=v+c.getAttribute(h);break;case-1:c[h]=c.getAttribute(h).replace(v,"")}c.setAttribute(h,c[h].replace(i,"/"))}var d,e=a.replace(/[^\/]+$/,""),f=c.URL.replace(/[^\/]+$/,""),_=e.split("/").length,y=f.split("/").length,i=/^.+?\w\//,v=this.util_.repeat("../",Math.abs(_-y));switch(!0){case _===y:d=0;break;case y>_:d=1;break;case _>y:d=-1}jQuery("[href], [src]",c).not(['[href^="/"]','[href^= "http:"]','[href^= "https:"]','[src^= "/"]','[src^= "http:"]','[src^= "https:"]'].join(",")).each(h)},c.prototype.escapeNoscript_=function(a){function c(){jQuery(this).text(this.innerHTML)}jQuery("noscript",a).children().parent().each(c)},c.prototype.restoreNoscript_=function(a){var c=jQuery("<span/>");return a.replace(/(<noscript>)([^<>]+?)(<\/noscript>)/gim,function(a,h,d,e){return h+c.html(d).text()+e})},c.prototype.escapeScript_=function(a){jQuery.data(a,"source",a.src),jQuery.data(a,"code",a.innerHTML),a.removeAttribute("src"),a.innerHTML=""},c.prototype.restoreScript_=function(a){undefined!==jQuery.data(a,"code")&&(a.innerHTML=" ",jQuery.data(a,"source")?(a.src=jQuery.data(a,"source"),jQuery.removeData(a,"source")):a.removeAttribute("src"),a.innerHTML=jQuery.data(a,"code"),jQuery.removeData(a,"code"))},c.prototype.chooseArea=function(){},c.prototype.dispatchEvent=function(){},c}();c.PageUpdate=h}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){var h=function(){function c(){this.util_=a.LIBRARY.Utility,this.sandbox_cache_={}}return c.prototype.sandbox_=function(a){var c=this;return void 0===a&&(a=window.location.href),a=this.util_.canonicalizeUrl(a).split("#").shift(),this.sandbox_cache_[a]&&"object"==typeof this.sandbox_cache_[a].document&&this.sandbox_cache_[a].document.URL===a||jQuery('<iframe srcdoc="<!DOCTYPE html>" sandbox="allow-same-origin"></iframe>').appendTo("body").each(function(h,d){c.sandbox_cache_[a]=d.contentWindow,c.sandbox_cache_[a].document.open(),c.sandbox_cache_[a].document.close()}).remove(),this.sandbox_cache_[a]},c.prototype.test_=function(a){try{var c='<html lang="en" class="html"><head><title>&amp;</title><link href="/"><noscript><style>/**/</style></noscript></head><body><noscript>noscript</noscript><a href="/"></a></body></html>',h=this.parse(c,window.location.href,a);switch(!1){case!!h:case h.URL&&decodeURI(h.URL)===decodeURI(window.location.href):case"&"===h.title:case!!h.querySelector('html.html[lang="en"]'):case!!h.querySelector("head>link").href:case!!h.querySelector("head>noscript").innerHTML:case!!h.querySelector("body>noscript").innerHTML:case!!h.querySelector("body>a").href:throw!0}return a}catch(d){}},c.prototype.parse=function(a,c,h){function d(a,c){var h=document.createElement("div");h.innerHTML=c.match(/<html(?:\s.*?[^\\])?>|$/i).shift().replace(/html/i,"div")||"<div>";for(var d,e=h.firstChild.attributes,f=0;d=e[f];f++)a.documentElement.setAttribute(d.name,d.value);var h=document.createElement("html");for(h.innerHTML=c.replace(/^.*?<html(?:\s.*?[^\\])?>/im,""),a.documentElement.removeChild(a.head),a.documentElement.removeChild(a.body);h.childNodes.length;)a.documentElement.appendChild(h.childNodes[0]);return a}void 0===c&&(c=""),void 0===h&&(h=this.mode_),a+=~a.search(/<title[\s>]/i)?"":"<title></title>";var e;switch(h){case"dom":e=(new window.DOMParser).parseFromString(a,"text/html");break;case"doc":if(e=document.implementation.createHTMLDocument(""),"object"!=typeof e.activeElement||!e.activeElement)break;"function"==typeof window.DOMParser&&(e.title=(new window.DOMParser).parseFromString(a.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i),"text/html").title),e.open(),e.write(a),e.close(),e.title!==e.querySelector("title").textContent&&(e.title=e.querySelector("title").textContent);break;case"manipulate":e=d(document.implementation.createHTMLDocument(""),a);break;case null:e=null;break;default:switch(/webkit|firefox|trident|$/i.exec(window.navigator.userAgent).shift().toLowerCase()){case"webkit":this.mode_=this.test_("doc")||this.test_("dom")||this.test_("manipulate");break;case"firefox":this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate");break;case"trident":this.mode_=this.test_("manipulate")||this.test_("dom")||this.test_("doc");break;default:this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate")}e=this.mode_&&this.parse(a,c)}return e},c}();c.PageParser=h;var d=function(){function a(){a.instance_=a.instance_||new h}return a.prototype.singleton_=function(){return a.instance_},a.prototype.parse=function(a,c){return this.singleton_().parse(a,c)},a}();c.PageParserSingleton=d}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h;!function(c){a.MIXIN(c.PageFetch,[c.PageUtility]),a.MIXIN(c.PageUpdate,[c.PageUtility]);var h=function(){function h(h,d,e){var f=this;this.model_=h,this.data_=d,this.balancer_=e,this.util_=a.LIBRARY.Utility,this.parser=new c.PageParserSingleton,this.provider=new c.PageProvider(c.PageRecord,this.model_,this.balancer_,this),this.landing=this.util_.normalizeUrl(window.location.href),this.loadedScripts={},this.dataXHR=[],this.loadtime=0,this.count=0,this.time=(new Date).getTime(),setTimeout(function(){return f.parser.parse("")||f.model_.disable()},100)}return h.prototype.transfer=function(c,h){switch(h.type.toLowerCase()){case a.EVENT.CLICK:this.data_.saveTitle(),this.data_.saveScrollPosition();break;case a.EVENT.SUBMIT:this.data_.saveTitle(),this.data_.saveScrollPosition();break;case a.EVENT.POPSTATE:this.data_.saveTitle(c.origLocation.href,document.title),c.fix.history&&this.data_.loadTitle()}c=jQuery.extend(!0,{},c),c.origLocation=c.origLocation.cloneNode(),c.destLocation=c.destLocation.cloneNode(),c=a.FREEZE(c),this.fetch_(c,h)},h.prototype.getWait=function(){return this.wait_},h.prototype.setWait=function(a){return this.wait_&&this.wait_.state&&"pending"===this.wait_.state()&&this.wait_.reject(),this.wait_=a},h.prototype.fetch_=function(a,c){var h=this;this.provider.fetchRecord(a,c,function(a,c,d){return h.success_(a,c,d)},function(a,c,d){return h.failure_(a,c,d)})},h.prototype.success_=function(a,h,d){new c.PageUpdate(this.model_,this,this.data_,this.balancer_,h,d,a)},h.prototype.failure_=function(a,c,h){var d=this;c.fallback&&"abort"!==a.data.textStatus()&&(this.data_.saveExpires(c.destLocation.href,"",0),c.balance.active&&(this.data_.saveServer(a.data.host(),(new Date).getTime()+c.balance.server.expires,0,0,(new Date).getTime()),this.balancer_.changeServer(this.balancer_.chooseServer(c),c)),setTimeout(function(){return d.model_.fallback(h)},100))},h.prototype.chooseArea=function(){},h.prototype.dispatchEvent=function(){},h}();c.Page=h}(h=c.APP||(c.APP={}))}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(MODULE){var MODEL;!function(MODEL){var APP;!function(APP){MODULE.MIXIN(APP.Page,[APP.PageUtility]);var Main=function(){function Main(a,c){this.model_=a,this.controller_=c,this.util_=MODULE.LIBRARY.Utility,this.settings_={},this.data=new APP.Data(this.model_),this.balancer=new APP.Balancer(this.data),this.page=new APP.Page(this.model_,this.data,this.balancer)}return Main.prototype.initialize=function(a,c){var h=this;this.controller_.view(a,c),this.balancer.enable(c),this.balancer.changeServer(this.balancer.chooseServer(c),c),this.data.loadBuffers(),setTimeout(function(){return h.page.landing=null},1500)},Main.prototype.configure=function(destination){var _this=this,event=destination.preventDefault?destination:null;switch(event&&"object"==typeof event&&event.type.toLowerCase()){case MODULE.EVENT.CLICK:return this.configure(event.currentTarget);case MODULE.EVENT.SUBMIT:return this.configure(event.currentTarget);case MODULE.EVENT.POPSTATE:return this.configure(window.location);case null:}var url;switch(!0){case"string"==typeof destination:url=destination;break;case"href"in destination&&"string"==typeof destination.href:url=this.util_.normalizeUrl(destination.href);break;case"href"in destination&&"object"==typeof destination.href:url=this.util_.normalizeUrl(destination.href.baseVal);break;case"action"in destination:switch(url=this.util_.normalizeUrl(destination.action.replace(/[?#].*/,"")),destination.method.toUpperCase()){case"GET":url+="?"+jQuery(destination).serialize()}break;default:url=this.model_.location.href,this.option_=destination}var index=[this.util_.canonicalizeUrl(this.model_.location.href).slice(0,2048),this.util_.canonicalizeUrl(url).slice(0,2048)].join(" ");if(!this.option_)return null;if(index in this.settings_)return this.settings_[index];var origLocation=this.model_.location.cloneNode(),destLocation=this.model_.location.cloneNode();origLocation.href=this.util_.canonicalizeUrl(origLocation.href),destLocation.href=this.util_.canonicalizeUrl(url);var scope=this.scope_(this.option_,origLocation.href,destLocation.href)||null,initial={area:"body",link:"a:not([target])",filter:function(){var a=document.createElement("a");return a.href="string"==typeof this.href?this.href:this.href.baseVal,/^https?:/.test(a.href)&&/\/[^.]*$|\.(html?|php)$/.test(a.pathname.replace(/^\/?/,"/"))},form:null,replace:null,bind:null,rewrite:null,scope:null,state:null,scrollTop:0,scrollLeft:0,ajax:{dataType:"text"},contentType:"text/html",redirect:!0,cache:{click:!1,submit:!1,popstate:!1,get:!0,post:!0,mix:0,limit:100,expires:{max:null,min:3e5}},buffer:{limit:30,delay:500},load:{head:"",css:!1,script:!1,ignore:'[src*="jquery.js"], [src*="jquery.min.js"], [href^="chrome-extension://"]',reload:"",log:"head, body",error:!0,ajax:{dataType:"script",cache:!0}},balance:{active:!1,bounds:["*"],weight:1,random:0,option:{server:{header:!1},ajax:{crossDomain:!0},callbacks:{ajax:{beforeSend:null}}},client:{hosts:[],support:{browser:/msie|trident.+ rv:|chrome|firefox|safari/i,redirect:/chrome|firefox|safari/i},cookie:{balance:"balanceable",redirect:"redirectable",host:"host"}},server:{header:"X-Ajax-Host",respite:6e5,expires:864e6}},wait:0,fallback:!0,reset:{type:"",count:100,time:108e5},fix:{location:!0,history:!0,scroll:!0,noscript:!0,reference:!0},database:{active:!0,revision:0,refresh:10},server:{query:null,header:!0},overlay:"",callback:null,callbacks:{ajax:{},update:{redirect:{},blur:{},url:{},rewrite:{},title:{},head:{},content:{},focus:{},scroll:{},css:{},script:{},balance:{}}},data:undefined},force={uid:MODULE.UUID(),ns:"",nss:undefined,speedcheck:undefined,origLocation:origLocation,destLocation:destLocation,scroll:{queue:[]},option:this.option_},compute=function(){setting.ns=setting.ns?setting.ns.split(".").sort().join("."):"";var nsArray=[MODULE.DEF.NAME].concat(setting.ns?setting.ns.split("."):[]),query=setting.server.query;switch(query&&typeof query){case"string":query=eval("({"+query.toString().match(/[^?=&]+=[^&]*/g).join("&").replace(/"/g,'\\"').replace(/([^?=&]+)=([^&]*)/g,'"$1": "$2"').replace(/&/g,",")+"})");case"object":query=jQuery.param(query);break;default:query=""}return{uid:undefined,ns:undefined,origLocation:undefined,destLocation:undefined,scroll:undefined,option:undefined,speedcheck:undefined,nss:{array:nsArray,name:nsArray.join("."),data:nsArray[0],url:_this.model_.convertUrlToKey(setting.destLocation.href,!0),event:{pjax:{fetch:[MODULE.EVENT.PJAX,"fetch"].join(":"),unload:[MODULE.EVENT.PJAX,"unload"].join(":"),DOMContentLoaded:[MODULE.EVENT.PJAX,"DOMContentLoaded"].join(":"),ready:[MODULE.EVENT.PJAX,"ready"].join(":"),render:[MODULE.EVENT.PJAX,"render"].join(":"),load:[MODULE.EVENT.PJAX,"load"].join(":")},click:[MODULE.EVENT.CLICK].concat(nsArray.join(":")).join("."),submit:[MODULE.EVENT.SUBMIT].concat(nsArray.join(":")).join("."),popstate:[MODULE.EVENT.POPSTATE].concat(nsArray.join(":")).join("."),scroll:[MODULE.EVENT.SCROLL].concat(nsArray.join(":")).join(".")},elem:nsArray.join("-"),requestHeader:["X",nsArray[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-")},fix:/android|iphone os|like mac os x/i.test(window.navigator.userAgent)?undefined:{location:!1},contentType:setting.contentType.replace(/\s*[,;]\s*/g,"|").toLowerCase(),database:{refresh:Math.min(setting.database.refresh,30)},reset:{type:(setting.reset.type||"").toLowerCase()},server:{query:query},timeStamp:(new Date).getTime()}},setting;return setting=jQuery.extend(!0,initial,scope||this.option_),setting=jQuery.extend(!0,setting,setting.balance.active&&setting.balance.option,force),setting=jQuery.extend(!0,setting,compute()),scope?(MODULE.FREEZE(setting,!0),this.settings_[index]=setting,setting):(this.settings_[index]=null,null)},Main.prototype.scope_=function(a,c,h){if(a=jQuery.extend(!0,{},a),!a.scope)return a;var d,e,f,_,y,i,v=a.scope;d=this.model_.convertUrlToKey(c,!0).match(/.+?\w(\/.*)/).pop(),e=this.model_.convertUrlToKey(h,!0).match(/.+?\w(\/.*)/).pop(),f=d.split("/");for(var g=f.length;g--;)if(_=f.slice(0,g+1).join("/"),_+="/"===d.charAt(_.length)?"/":"",_&&_ in v){var l;if(v[_]instanceof Array?(y="",l=v[_]):(y=v[_],l=v[y]),l){l=l.concat();var m,n,o,p=[];o=i=m=n=undefined;for(var q,r=0;q=l[r];r++){if("#"===q.charAt(0)){if(~jQuery.inArray(q,p)||!(q.length>1)){y="";continue}p.push(q),y=q.slice(1),[].splice.apply(l,[r,1].concat(v[y],"#")),q=l[r]}if("inherit"===q)o=!0;else if("string"==typeof q){var s="!"===q.charAt(0);q=s?q.slice(1):q;var t="*"===q.charAt(0);q=t?q.slice(1):q,(t?~d.search(q):~d.indexOf(q))&&(s?m=!1:(m=!0,i=v["$"+y]||v["$"+q]||undefined)),(t?~e.search(q):~e.indexOf(q))&&(s?n=!1:(n=!0,i=v["$"+y]||v["$"+q]||undefined))}if(!1===m||!1===n)return null}if(m&&n)return jQuery.extend(!0,a,i);if(!o)break}}return undefined},Main}();APP.Main=Main}(APP=MODEL.APP||(MODEL.APP={}))}(MODEL=MODULE.MODEL||(MODULE.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(a){a.App=a.APP.Main}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){var c;!function(c){var h=function(h){function d(){h.call(this,a.State.initiate),this.controller_=new a.Controller(this).singleton(),this.app_=new c.App(this,this.controller_),this.util_=a.LIBRARY.Utility,this.isDeferrable=!!jQuery.when&&"1.006"<=jQuery().jquery.match(/\d[\d.]+\d/).pop().replace(/\.(\d+)/g,".00$1").replace(/0*(\d{3})/g,"$1"),this.location=document.createElement("a"),this.queue_=[]}return __extends(d,h),d.prototype.host=function(){return this.app_.balancer.host()},d.prototype.state=function(){return this.state_},d.prototype.main_=function(c,h){var d=this;switch(typeof h){case"object":c=c instanceof a.DEF.NAMESPACE?c:jQuery(document)[a.DEF.NAME](),a.FREEZE(h,!0);break;default:return c}if(!window.history||!window.history.pushState||!window.history.replaceState)return c;this.location.href=this.util_.normalizeUrl(window.location.href);var e=this.app_.configure(h);return e?(this.app_.data.connect(e),this.speed={fire:0,time:[],name:[],now:function(){return(new Date).getTime()}},jQuery(function(){d.app_.initialize(c,e),d.state_=d.state()===a.State.initiate?a.State.open:d.state(),d.overlay(e,!0)}),c):c},d.prototype.convertUrlToKey=function(a,c){return a=c?this.util_.canonicalizeUrl(a):a,this.util_.trim(a).split("#").shift()},d.prototype.compareKeyByUrl=function(a,c){return a=this.convertUrlToKey(a,!0),c=this.convertUrlToKey(c,!0),a===c},d.prototype.comparePageByUrl=function(a,c){return a=this.convertUrlToKey(a,!0),c=this.convertUrlToKey(c,!0),a===c},d.prototype.configure=function(a){return this.app_.configure(a)},d.prototype.isOperatable=function(c){if(a.State.open!==this.state())return!1;if(c.which>1||c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)return!1;var h;switch(c.type.toLowerCase()){case a.EVENT.CLICK:if(h=this.app_.configure(c.currentTarget),h&&!jQuery(c.currentTarget).filter(h.filter).length)return!1;break;case a.EVENT.SUBMIT:h=this.app_.configure(c.currentTarget);break;case a.EVENT.POPSTATE:h=this.app_.configure(window.location)}if(!h)return!1;if(h.origLocation.protocol!==h.destLocation.protocol||h.origLocation.host!==h.destLocation.host)return!1;switch(c.type.toLowerCase()){case a.EVENT.CLICK:if(this.comparePageByUrl(h.origLocation.href,h.destLocation.href)&&h.destLocation.hash)return!1;break;case a.EVENT.SUBMIT:break;case a.EVENT.POPSTATE:if(this.comparePageByUrl(h.origLocation.href,h.destLocation.href))return!1}return this.app_.page.chooseArea(h.area,document,document)?!0:!1},d.prototype.getPageXHR=function(){return this.app_.page.pageXHR},d.prototype.setPageXHR=function(a){return this.app_.page.pageXHR&&this.app_.page.pageXHR.readyState<4&&this.app_.page.pageXHR!==a&&this.app_.page.pageXHR.abort(),this.app_.page.pageXHR=a},d.prototype.getDataXHR=function(){return this.app_.page.dataXHR},d.prototype.setDataXHR=function(a){function c(c){switch(!0){case c>=h.length:case 4===h[c].readyState:case h.indexOf(a[c])>-1:return a[c]}return h[c].abort(),a[c]}a=a||[];var h=this.app_.page.dataXHR;return this.app_.page.dataXHR=Array.apply(null,Array(Math.max(a.length,this.app_.page.dataXHR.length))).map(function(a,h){return c(h)}).filter(function(a){return!!a})},d.prototype.click=function(c){c.timeStamp=(new Date).getTime();var h=c.currentTarget,d=(jQuery(h),this.app_.configure(h));switch(this.location.href=this.util_.normalizeUrl(window.location.href),!0){case!d:case c.isDefaultPrevented():case this.state()!==a.State.open:break;case this.isOperatable(c):this.app_.page.transfer(d,c),c.preventDefault();break;case this.isHashChange(d)&&this.overlay(d):c.preventDefault(),window.history.pushState(null,document.title,d.destLocation.href);break;case!c.originalEvent&&!jQuery(document).has(h).length:this.fallback(c)}},d.prototype.submit=function(c){c.timeStamp=(new Date).getTime();var h=c.currentTarget,d=(jQuery(h),this.app_.configure(h));switch(this.location.href=this.util_.normalizeUrl(window.location.href),!0){case!d:case c.isDefaultPrevented():case this.state()!==a.State.open:break;case this.isOperatable(c):this.app_.page.transfer(d,c),c.preventDefault();break;case!c.originalEvent&&!jQuery(document).has(h).length:this.fallback(c)}},d.prototype.popstate=function(c){if(!this.app_.page.landing||!this.util_.compareUrl(this.app_.page.landing,window.location.href)){c.timeStamp=(new Date).getTime();var h=this.app_.configure(window.location);switch(!0){case!h:!this.comparePageByUrl(this.location.href,window.location.href)&&this.fallback(c);break;case this.state()!==a.State.open:break;case this.isOperatable(c):this.app_.page.transfer(h,c);break;case this.isHashChange(h)&&this.overlay(h):break;case!this.comparePageByUrl(h.origLocation.href,window.location.href):this.fallback(c)}this.location.href=this.util_.normalizeUrl(window.location.href)}},d.prototype.scroll=function(){for(var a,d=this;a=this.queue_.shift();)clearTimeout(a);a=setTimeout(function(){for(;a=d.queue_.shift();)clearTimeout(a);d.compareKeyByUrl(window.location.href,d.location.href)&&d.app_.data.saveScrollPosition()},300),this.queue_.push(a)},d.prototype.fallback=function(a){var c=this.configure(a);switch(!0){case c&&!c.fallback:case c&&!1===this.util_.fire(c.fallback,c,[a,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]):break;default:this.movePageNormally_(a)}},d.prototype.movePageNormally_=function(c){switch(c.type.toLowerCase()){case a.EVENT.CLICK:window.location.assign("string"==typeof c.currentTarget.href?c.currentTarget.href:c.currentTarget.href.baseVal);break;case a.EVENT.SUBMIT:switch(c.currentTarget.method.toUpperCase()){case"GET":window.location.assign(c.currentTarget.action.replace(/[?#].*/,"")+"?"+jQuery(c.currentTarget).serialize());break;case"POST":window.location.assign(c.currentTarget.action)}break;case a.EVENT.POPSTATE:window.location.reload()}},d.prototype.isHashChange=function(a){return!!a&&a.origLocation.href.replace(/#.*/,"")===a.destLocation.href.replace(/#.*/,"")&&a.origLocation.hash!==a.destLocation.hash},d.prototype.overlay=function(a,c){var h=this,d=a.destLocation.hash.replace(/^#/,"");if(!d||!a.overlay)return!1;var e=jQuery("#"+d+", [name~="+d+"]");if(e=e.add(e.nextUntil(":header")),e=e.filter(a.overlay).add(e.find(a.overlay)).first(),!e.length)return!1;this.isHashChange(a)&&(this.app_.data.loadScrollPosition(),setTimeout(function(){return h.app_.data.loadScrollPosition()},1));var f=jQuery("<div>");return e=e.clone(!0),f.addClass(a.nss.elem+"-overlay").css({background:"rgba(255, 255, 255, 0.8)",display:"none",position:"fixed",top:0,left:0,right:0,bottom:0,margin:0,padding:0,border:"none"}).append(e.css({position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto"}).show()),f.bind("click",f,function(a){a.target===a.currentTarget&&(window.history.pushState(window.history.state,document.title,window.location.href.replace(/#.*/,"")),h.location.href=h.util_.normalizeUrl(window.location.href),jQuery(a.data).fadeOut("fast",function(){return jQuery(a.data).remove()}))}),f.appendTo("body").fadeIn(c?0:100),jQuery(window).one("popstate",f,function(a){setTimeout(function(){return h.app_.data.loadScrollPosition()},1),jQuery(a.data).fadeOut("fast",function(){return jQuery(a.data).remove()})}),/trident/i.test(window.navigator.userAgent)&&e.width(e.width()),this.app_.data.saveScrollPosition(),!0},d.prototype.enable=function(){this.state_=a.State.open},d.prototype.disable=function(){this.state_=a.State.pause},d.prototype.getCache=function(a){var c=this.configure(this.convertUrlToKey(a));if(c){var h=this.app_.page.provider.getRecord(c);return h.state(c)||h.data.data()?{data:h.data.data(),textStatus:h.data.textStatus(),jqXHR:h.data.jqXHR(),expires:h.data.expires(),host:h.data.host()}:void this.removeCache(a)}},d.prototype.setCache=function(a,c,h,d){var e=this.configure(this.convertUrlToKey(a));if(e){var f=this.app_.page.provider.getRecord(e);this.app_.page.provider.setRecord(e,c||"",h||f.data.textStatus(),d||f.data.jqXHR(),this.app_.balancer.sanitize(d,e)||f.data.host()||"",null)}},d.prototype.removeCache=function(a){var c=this.configure(this.convertUrlToKey(a));c&&this.app_.page.provider.removeRecord(c)},d.prototype.clearCache=function(){this.app_.page.provider.clearRecord()},d.prototype.bypass=function(){return this.app_.balancer.bypass(this.app_.configure(window.location))},d}(c.Template);c.Main=h;var d=function(){function a(){a.instance_=a.instance_||new h}return a.singleton=function(){return a.instance_},a.prototype.singleton=function(){return a.singleton()},a}();c.Singleton=d}(c=a.MODEL||(a.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(a){a.Model=a.MODEL.Singleton}(MODULE||(MODULE={}));var Module=function(){function a(){new MODULE.Model}return a}();new Module}(window,window.document,void 0,jQuery);